cluster:
  control_planes: 3
  workers: 2

provider:
  name: libvirt
  libvirt:
    cpu_mode: custom
    cpu_model: qemu64

resources:
  control_plane:
    cpus: 2
    memory: 2048
  worker:
    cpus: 1
    memory: 1536
  api_lb:
    cpus: 1
    memory: 512

network:
  prefix: 10.31.0
  pod_cidr: 10.244.0.0/16
  service_cidr: 10.96.0.0/12
  api_lb:
    enabled: true
    ip: 10.31.0.5
    hostname: k8s-api.local

kubernetes:
  channel: v1.30
  version: 1.30.6-1.1
  cni: flannel
  cni_manifest_flannel: https://github.com/flannel-io/flannel/releases/download/v0.26.3/kube-flannel.yml
  cni_manifest_calico: https://raw.githubusercontent.com/projectcalico/calico/v3.29.0/manifests/calico.yaml
  cni_manifest_cilium: https://raw.githubusercontent.com/cilium/cilium/v1.16.5/install/kubernetes/quick-install.yaml
  pause_image: registry.k8s.io/pause:3.9

vagrant:
  box: ffreis/k8s-base-ubuntu24
  box_version: ""

packages:
  containerd: 1.7.28-0ubuntu1~24.04.2
  haproxy: 2.8.16-0ubuntu0.24.04.1

apt:
  proxy: ""

ssh:
  public_key: ""

tuning:
  # How long to wait for artifacts from cp1 bootstrap before joining
  join_max_wait_seconds: 1200  # Increased from 900 - gives more time for etcd to stabilize
  join_poll_seconds: 5
  cp1_init_timeout_seconds: 1800
  cp1_prepull_images: true
  cp1_prepull_timeout_seconds: 1200
  cp1_progress_interval_seconds: 20
  
  # etcd learner warning throttling during join attempts
  cp_join_warn_show_limit: 2
  cp_join_warn_report_interval_seconds: 120
  cp_join_warn_report_every: 250
  
  # Retry strategy for control plane join (cp2, cp3, etc.)
  cp_join_retry_attempts: 8  # Increased from 5 - more retries for transient failures
  cp_join_retry_sleep_seconds: 15
  cp_join_retry_backoff_factor: 2  # Exponential backoff: 15s, 30s, 60s, ...
  cp_join_retry_max_sleep_seconds: 120  # Increased from 90 - allow longer backoff between attempts
  cp_join_retry_max_total_seconds: 2400  # Increased from 1200 - 40 min total timeout for multi-CP joins
  
  # How long to wait for cluster to stabilize before validation
  cp_stabilize_timeout_seconds: 900  # Increased from 600 - more time for etcd rebalancing
  cp_stabilize_poll_seconds: 5
  
  # Validation checks
  validate_ready_timeout_seconds: 300
  validate_ready_poll_seconds: 5
  
  # Vagrant bootstrap retries
  vagrant_retry_attempts: 10
  vagrant_retry_sleep_seconds: 15
  vagrant_retry_backoff_factor: 2
  vagrant_retry_max_sleep_seconds: 120
  vagrant_retry_max_total_seconds: 1200
  worker_parallelism: 2
  apt_lock_timeout_seconds: 300
  apt_lock_poll_seconds: 3
